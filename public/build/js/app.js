let paso=1;const pasoInicial=1,pasoFinal=4,cita={usuarioID:"",nombre:"",fecha:"",formaPago:"",servicio:{id:"",nombre:"",precio:""},horario:{id:"",horarioSeleccionado:""}};document.addEventListener("DOMContentLoaded",(()=>{iniciarApp()}));const iniciarApp=()=>{mostrarSeccion(),tabs(),botonesPaginador(),paginaSiguiente(),paginaAnterior(),consultarAPIServicios(),consultarAPIHorarios(),obtenerIDCliente(),obtenerNombreCliente(),seleccionarFecha(),seleccionarHorario(),mostrarOcultarFormaPago(),mostrarResumen()},mostrarSeccion=()=>{const e=document.querySelector(".mostrar");e&&e.classList.remove("mostrar");const o=`#paso-${paso}`;document.querySelector(o).classList.add("mostrar");const a=document.querySelector(".tabs .activo");a&&a.classList.remove("activo");document.querySelector(`[data-paso="${paso}"]`).classList.add("activo")},tabs=()=>{document.querySelectorAll(".tabs button").forEach((e=>{e.addEventListener("click",(e=>{paso=parseInt(e.target.dataset.paso),mostrarSeccion(),botonesPaginador()}))}))},botonesPaginador=()=>{const e=document.querySelector("#siguiente"),o=document.querySelector("#anterior");1===paso?(o.classList.add("ocultarBoton"),e.classList.remove("ocultarBoton")):4===paso?(o.classList.remove("ocultarBoton"),e.classList.add("ocultarBoton"),mostrarResumen()):(o.classList.remove("ocultarBoton"),e.classList.remove("ocultarBoton")),mostrarSeccion()},paginaSiguiente=()=>{const e=document.querySelector("#siguiente");paso>=4||e.addEventListener("click",(()=>{paso++,botonesPaginador()}))},paginaAnterior=()=>{document.querySelector("#anterior").addEventListener("click",(()=>{paso<=1||(paso--,botonesPaginador())}))},consultarAPIServicios=async()=>{try{const e="http://localhost:3000/api/servicios",o=await fetch(e),a=await o.json();mostrarServicios(a)}catch(e){console.log(e)}},mostrarServicios=e=>{e.forEach((e=>{const{id:o,nombre:a,precio:t}=e,n=document.createElement("P");n.classList.add("nombre-servicio"),n.textContent=a;const r=document.createElement("P");r.classList.add("precio-servicio"),r.textContent=`Bs. ${t}`;const s=document.createElement("DIV");s.classList.add("servicio"),s.dataset.idServicio=o,s.onclick=()=>{seleccionarServicio(e)},s.appendChild(n),s.appendChild(r),document.querySelector("#servicios").appendChild(s)}))},seleccionarServicio=e=>{const{id:o,nombre:a,precio:t}=e,n=document.querySelector(`[data-id-servicio="${o}"]`);if(cita.servicio.id===o)cita.servicio.id="",n.classList.remove("seleccionado");else{if(cita.servicio.id){const e=document.querySelector(`[data-id-servicio="${cita.servicio.id}"]`);e&&e.classList.remove("seleccionado")}cita.servicio.id=o,cita.servicio.nombre=a,cita.servicio.precio=t,n.classList.add("seleccionado")}console.log(cita)},consultarAPIHorarios=async()=>{try{const e="http://localhost:3000/api/horarios",o=await fetch(e),a=await o.json();mostrarHorarios(a)}catch(e){console.log(e)}},mostrarHorarios=e=>{e.forEach((e=>{const{id:o,horaInicio:a,horaFin:t}=e,n=document.createElement("OPTION");n.value=o,n.textContent=`${a} - ${t}`,document.querySelector("#horarios").appendChild(n)}))},seleccionarHorario=()=>{document.querySelector("#horarios").addEventListener("change",(e=>{cita.horario.id=parseInt(e.target.selectedOptions[0].value),cita.horario.horarioSeleccionado=e.target.selectedOptions[0].text}))},obtenerIDCliente=()=>{const e=document.querySelector("#id").value;cita.usuarioID=e},obtenerNombreCliente=()=>{const e=document.querySelector("#nombre").value;cita.nombre=e},seleccionarFecha=()=>{document.querySelector("#fecha").addEventListener("input",(e=>{const o=new Date(e.target.value).getUTCDay();[0].includes(o)?(e.target.value="",mostrarAlerta("No hay atenciÃ³n domingo","error",".formulario")):cita.fecha=e.target.value}))},mostrarAlerta=(e,o,a,t=!0)=>{const n=document.querySelector(".alerta");n&&n.remove();const r=document.createElement("DIV");r.textContent=e,r.classList.add("alerta"),r.classList.add(o);document.querySelector(a).appendChild(r),t&&setTimeout((()=>{r.remove()}),2500)},mostrarOcultarFormaPago=()=>{const e=document.querySelectorAll('input[name="pago"]'),o=document.querySelector("#pagos__qr"),a=o.dataset.qrUrl;e.forEach((e=>{e.addEventListener("click",(e=>{console.log(e.target.value),"1"===e.target.value?(cita.formaPago=e.target.value,o.innerHTML='<p class="text-center">Presiona el boton siguiente para continuar</p>'):"2"===e.target.value&&(cita.formaPago=e.target.value,o.innerHTML=`<img src="${a}" alt="QR">`)}))}))},mostrarResumen=()=>{const e=document.querySelector(".contenido-resumen");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(cita).includes(""))return void mostrarAlerta("Faltan datos de los servicios, fecha, horario o forma de pago","error",".contenido-resumen",!1);const{nombre:o,fecha:a,horario:t,servicio:n}=cita,r=new Date(a),s=r.getMonth(),c=r.getDate()+2,i=r.getFullYear(),d=new Date(Date.UTC(i,s,c)).toLocaleDateString("es-BO",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),l=document.createElement("H3");l.textContent="Resumen de los Datos de la Cita",l.classList.add("resumen-heading"),e.appendChild(l);const m=document.createElement("DIV");m.classList.add("resumen-decorador"),e.appendChild(m);const u=document.createElement("DIV");u.classList.add("contenedor-resumen"),e.appendChild(u);const p=document.createElement("DIV");p.classList.add("resumen-seccion");const v=document.createElement("DIV");v.classList.add("resumen-campo"),v.innerHTML=`\n        <div class="resumen-icono resumen-icono-usuario"></div>\n        <div class="resumen-info">\n            <span class="resumen-etiqueta">Nombre:</span>\n            <p class="resumen-valor">${o}</p>\n        </div>\n    `;const h=document.createElement("DIV");h.classList.add("resumen-campo"),h.innerHTML=`\n        <div class="resumen-icono resumen-icono-calendario"></div>\n        <div class="resumen-info">\n            <span class="resumen-etiqueta">Fecha:</span>\n            <p class="resumen-valor">${d}</p>\n        </div>\n    `;const g=document.createElement("DIV");g.classList.add("resumen-campo"),g.innerHTML=`\n        <div class="resumen-icono resumen-icono-reloj"></div>\n        <div class="resumen-info">\n            <span class="resumen-etiqueta">Hora:</span>\n            <p class="resumen-valor">${t.horarioSeleccionado}</p>\n        </div>\n    `,p.appendChild(v),p.appendChild(h),p.appendChild(g),u.appendChild(p);const L=document.createElement("DIV");L.classList.add("resumen-separador"),u.appendChild(L);const S=document.createElement("DIV");S.classList.add("resumen-seccion");const f=document.createElement("DIV");f.classList.add("resumen-campo"),f.innerHTML=`\n        <div class="resumen-icono resumen-icono-tijeras"></div>\n        <div class="resumen-info">\n            <span class="resumen-etiqueta">Servicio:</span>\n            <p class="resumen-valor">${n.nombre}</p>\n        </div>\n    `;const C=document.createElement("DIV");C.classList.add("resumen-campo","resumen-pago"),C.innerHTML=`\n        <div class="resumen-icono resumen-icono-tarjeta"></div>\n        <div class="resumen-info-contenedor">\n            <div class="resumen-info-pago">\n                <span class="resumen-etiqueta">Total:</span>\n                <p class="resumen-valor resumen-valor-precio">Bs. ${n.precio}</p>\n            </div>\n            <div class="resumen-info-pago">\n                <span class="resumen-etiqueta">Forma de Pago:</span>\n                <p class="resumen-valor">${"1"===cita.formaPago?"Efectivo":"QR"}</p>\n            </div>\n        </div>\n    `,S.appendChild(f),S.appendChild(C),u.appendChild(S);const y=document.createElement("DIV");y.classList.add("resumen-acciones");const b=document.createElement("BUTTON");b.classList.add("boton","boton-confirmar"),b.textContent="Confirmar Cita",b.onclick=reservarCita,y.appendChild(b),e.appendChild(y)},reservarCita=async()=>{const{usuarioID:e,fecha:o,horario:a,servicio:t,formaPago:n}=cita,r=new FormData;r.append("usuarioID",e),r.append("fecha",o),r.append("horarioID",a.id),r.append("servicioID",t.id),r.append("formaPagoID",n);try{const e="http://localhost:3000/api/citas",o=await fetch(e,{method:"POST",body:r}),a=await o.json();console.log(a.resultado),a.resultado&&Swal.fire({icon:"success",title:"Cita creada",text:"La cita se ha creado correctamente"}).then((()=>{setTimeout((()=>{window.location.reload()}),1e3)}))}catch(e){Swal.fire({icon:"error",title:"Error...",text:"Hubo un error al guardar la cita"}),console.log(e)}};